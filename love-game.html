<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’• ì‚¬ë‘í•´ ê²Œì„ ğŸ’•</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }

        .title {
            font-size: 2.5rem;
            color: #e91e63;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 30px;
        }

        .game-mode-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .mode-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: bold;
        }

        .mode-btn:hover {
            transform: scale(1.05);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #e91e63 0%, #f06292 100%);
        }

        .game-area {
            display: none;
        }

        .game-area.active {
            display: block;
        }

        .choices {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .choice-btn {
            background: white;
            border: 3px solid #667eea;
            padding: 20px;
            border-radius: 15px;
            font-size: 3rem;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 80px;
        }

        .choice-btn:hover {
            background: #667eea;
            transform: scale(1.1);
        }

        .result-area {
            margin: 30px 0;
            font-size: 1.3rem;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .love-message {
            font-size: 2rem;
            color: #e91e63;
            font-weight: bold;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .reset-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 1.1rem;
            cursor: pointer;
            margin: 10px;
            font-weight: bold;
        }

        .reset-btn:hover {
            transform: scale(1.05);
        }

        .flip-card {
            width: 60px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .flip-card.flipped {
            transform: rotateY(180deg);
        }

        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }

        .flip-card-back {
            background: linear-gradient(135deg, #e91e63 0%, #f06292 100%);
            transform: rotateY(180deg);
        }

        .fate-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fate-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .fate-card.selected {
            border: 3px solid #ff6b6b;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="title">ğŸ’• ì‚¬ë‘í•´ ê²Œì„ ğŸ’•</div>
        <div class="subtitle">ë‹¨ê³„ë³„ë¡œ ë” ê¹Šì€ ë§ˆìŒì„ ì „í•´ë³´ì„¸ìš”!</div>
        
        <!-- ê²Œì„ ëª¨ë“œ ì„ íƒ -->
        <div class="game-mode-buttons">
            <button class="mode-btn" onclick="selectMode('level1')">1ë‹¨ê³„ (ê¸°ë³¸)</button>
            <button class="mode-btn" onclick="selectMode('level4')">4ë‹¨ê³„ (ìš´ëª…ì˜ì¹´ë“œ)</button>
        </div>
        
        <!-- ì†Œë¦¬ ì¡°ì ˆ -->
        <div style="text-align: center; margin: 15px 0; padding: 10px; background: #e3f2fd; border-radius: 10px;">
            <div style="font-weight: bold; color: #1976d2; margin-bottom: 10px;">ğŸ”Š ìŒì„± ì„¤ì •</div>
            <div style="display: flex; align-items: center; justify-content: center; gap: 15px; flex-wrap: wrap;">
                <label style="display: flex; align-items: center; gap: 5px;">
                    <input type="checkbox" id="soundToggle" checked onchange="toggleSound()">
                    <span>ìŒì„± ì•ˆë‚´ ì¼œê¸°</span>
                </label>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span>ì†ë„:</span>
                    <input type="range" id="speedSlider" min="0.5" max="1.5" step="0.1" value="0.8" onchange="updateSpeechSettings()" style="width: 100px;">
                    <span id="speedValue">0.8</span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span>ìŒë†’ì´:</span>
                    <input type="range" id="pitchSlider" min="0.5" max="2" step="0.1" value="1.1" onchange="updateSpeechSettings()" style="width: 100px;">
                    <span id="pitchValue">1.1</span>
                </div>
            </div>
        </div>

        <!-- 1ë‹¨ê³„ ê²Œì„ -->
        <div id="level1-game" class="game-area">
            <div class="choices">
                <button class="choice-btn" onclick="playRPS('rock')">âœŠ</button>
                <button class="choice-btn" onclick="playRPS('paper')">âœ‹</button>
                <button class="choice-btn" onclick="playRPS('scissors')">âœŒï¸</button>
            </div>
            <div class="result-area" id="level1-result"></div>
            <button class="reset-btn" onclick="resetLevel1()">ë‹¤ì‹œ í•˜ê¸°</button>
        </div>

        <!-- 4ë‹¨ê³„: ìš´ëª…ì˜ ì¹´ë“œ ê²Œì„ -->
        <div id="fate-game" class="game-area">
            <div style="text-align: center; margin: 20px 0;">
                <div style="font-size: 1.3rem; font-weight: bold; color: #e91e63; margin-bottom: 15px;">
                    ğŸ´ ìš´ëª…ì˜ ì—°ì†ìŠ¹ë¶€ ğŸ´
                </div>
                <div style="color: #666; margin-bottom: 20px;">
                    ìŠ¹ë¦¬í•˜ë©´ +1ì , íŒ¨ë°°í•˜ë©´ -1ì ! ë¨¼ì € 5ì ì— ë„ë‹¬í•˜ì„¸ìš”!
                </div>
                
                <!-- ë³´ìƒ ë¯¸ë¦¬ë³´ê¸° -->
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 20px 0; font-size: 0.9rem;">
                    <div style="font-weight: bold; color: #333; margin-bottom: 10px;">ğŸ¯ ì ìˆ˜ë³„ ë³´ìƒ:</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px; text-align: left;">
                        <div>1ì : "ê³ ë§ˆì›Œ"</div>
                        <div>2ì : "ì¢‹ì•„í•´"</div>
                        <div>3ì : "<strong>ì†Œì¤‘í•´, í•¨ê»˜ ìˆì–´ì„œ í–‰ë³µí•´</strong>"</div>
                        <div>4ì : "ë„ˆëŠ” íŠ¹ë³„í•œ ì‚¬ëŒì´ì•¼"</div>
                        <div style="color: #e91e63; font-weight: bold;">5ì : "ğŸ‰ ì‚¬ë‘í•´, ì˜ì›íˆ í•¨ê»˜í•˜ì! ğŸ‰"</div>
                    </div>
                </div>
            </div>

            <!-- ì ìˆ˜íŒ -->
            <div style="display: flex; justify-content: center; gap: 40px; margin: 20px 0; flex-wrap: wrap;">
                <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; min-width: 180px;">
                    <div style="font-weight: bold; margin-bottom: 5px;">í”Œë ˆì´ì–´ 1</div>
                    <div style="font-size: 1.5rem; margin-bottom: 5px;" id="fate-player1-wins">0</div>
                    <div style="font-size: 0.9rem;">ì ìˆ˜</div>
                    <div style="margin-top: 10px; font-size: 0.8rem; opacity: 0.8;" id="fate-player1-progress">ğŸ”¹ğŸ”¹ğŸ”¹ğŸ”¹ğŸ”¹</div>
                </div>
                <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #e91e63 0%, #f06292 100%); color: white; border-radius: 15px; min-width: 180px;">
                    <div style="font-weight: bold; margin-bottom: 5px;">í”Œë ˆì´ì–´ 2</div>
                    <div style="font-size: 1.5rem; margin-bottom: 5px;" id="fate-player2-wins">0</div>
                    <div style="font-size: 0.9rem;">ì ìˆ˜</div>
                    <div style="margin-top: 10px; font-size: 0.8rem; opacity: 0.8;" id="fate-player2-progress">ğŸ”¹ğŸ”¹ğŸ”¹ğŸ”¹ğŸ”¹</div>
                </div>
            </div>

            <!-- í˜„ì¬ ë¼ìš´ë“œ ì •ë³´ -->
            <div style="text-align: center; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                <div style="font-weight: bold; color: #333; margin-bottom: 5px;">ë¼ìš´ë“œ <span id="current-round">1</span></div>
                <div style="color: #666;" id="round-info">ì²« ë²ˆì§¸ ëŒ€ê²°ì„ ì‹œì‘í•˜ì„¸ìš”!</div>
            </div>

            <!-- ì¹´ë“œ ì„ íƒ ì˜ì—­ -->
            <div style="text-align: center; margin: 30px 0;">
                <div style="font-size: 1.1rem; font-weight: bold; color: #333; margin-bottom: 20px;">
                    6ì¥ì˜ ì¹´ë“œ ì¤‘ì—ì„œ ê°ì í•˜ë‚˜ì”© ì„ íƒí•˜ì„¸ìš”
                </div>
                
                <!-- 6ì¥ì˜ ì¹´ë“œê°€ í•œ ì¤„ë¡œ ë°°ì¹˜ -->
                <div style="display: flex; justify-content: center; gap: 10px; margin: 20px 0; flex-wrap: wrap;">
                    <div class="flip-card fate-card" onclick="selectFateCard('all', 0)">
                        <div class="flip-card-front">ğŸ´</div>
                        <div class="flip-card-back" id="fate-card-0">â“</div>
                    </div>
                    <div class="flip-card fate-card" onclick="selectFateCard('all', 1)">
                        <div class="flip-card-front">ğŸ´</div>
                        <div class="flip-card-back" id="fate-card-1">â“</div>
                    </div>
                    <div class="flip-card fate-card" onclick="selectFateCard('all', 2)">
                        <div class="flip-card-front">ğŸ´</div>
                        <div class="flip-card-back" id="fate-card-2">â“</div>
                    </div>
                    <div class="flip-card fate-card" onclick="selectFateCard('all', 3)">
                        <div class="flip-card-front">ğŸ´</div>
                        <div class="flip-card-back" id="fate-card-3">â“</div>
                    </div>
                    <div class="flip-card fate-card" onclick="selectFateCard('all', 4)">
                        <div class="flip-card-front">ğŸ´</div>
                        <div class="flip-card-back" id="fate-card-4">â“</div>
                    </div>
                    <div class="flip-card fate-card" onclick="selectFateCard('all', 5)">
                        <div class="flip-card-front">ğŸ´</div>
                        <div class="flip-card-back" id="fate-card-5">â“</div>
                    </div>
                </div>

                <!-- ì„ íƒ ìƒíƒœ í‘œì‹œ -->
                <div style="display: flex; justify-content: center; gap: 40px; margin: 20px 0;">
                    <div style="color: #667eea; font-weight: bold;" id="fate-player1-status">í”Œë ˆì´ì–´ 1: ì°¨ë¡€ë¥¼ ê¸°ë‹¤ë¦¬ì„¸ìš”</div>
                    <div style="color: #e91e63; font-weight: bold;" id="fate-player2-status">í”Œë ˆì´ì–´ 2: ì°¨ë¡€ë¥¼ ê¸°ë‹¤ë¦¬ì„¸ìš”</div>
                </div>
                
                <!-- í˜„ì¬ ì°¨ë¡€ ì•ˆë‚´ -->
                <div style="text-align: center; margin: 15px 0; padding: 10px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <div style="font-weight: bold; color: #856404;" id="turn-indicator">ì²« ë¼ìš´ë“œ: í”Œë ˆì´ì–´ 1ë¶€í„° ì‹œì‘!</div>
                </div>
            </div>

            <!-- ë™ì‹œì— ë’¤ì§‘ê¸° ë²„íŠ¼ -->
            <div style="text-align: center; margin: 30px 0;">
                <button class="reset-btn" onclick="revealFateCards()" id="fate-reveal-btn" style="font-size: 1.3rem; padding: 15px 30px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);" disabled>
                    ğŸ­ ìš´ëª…ì„ í™•ì¸í•˜ì„¸ìš”!
                </button>
            </div>

            <div class="result-area" id="fate-result"></div>
            <button class="reset-btn" onclick="resetFateGame()">ìƒˆë¡œìš´ ìš´ëª…</button>
        </div>
    </div>

    <script>
        // ê²Œì„ ë³€ìˆ˜ë“¤
        let fatePlayer1Selected = null;
        let fatePlayer2Selected = null;
        let fateCards = [];
        let fateRevealed = false;
        let fatePlayer1Wins = 0;
        let fatePlayer2Wins = 0;
        let fateCurrentRound = 1;
        let fateTargetWins = 5;
        let lastWinner = null; // ë§ˆì§€ë§‰ ìŠ¹ì (ë‹¤ìŒ ë¼ìš´ë“œì—ì„œ ì§„ ì‚¬ëŒì´ ë¨¼ì € ì„ íƒ)
        
        // ìŒì„± ì„¤ì • ë³€ìˆ˜ë“¤
        let soundEnabled = true;
        let speechRate = 0.8;
        let speechPitch = 1.1;

        // ì ìˆ˜ì— ë”°ë¥¸ íŠ¹ë³„ ë³´ìƒë“¤ (ì‹¤ì œë¡œ ë§í•´ì•¼ í•˜ëŠ” ë¬¸êµ¬)
        const fateRewards = {
            1: "ê³ ë§ˆì›Œ",
            2: "ì¢‹ì•„í•´", 
            3: "ì†Œì¤‘í•´, í•¨ê»˜ ìˆì–´ì„œ í–‰ë³µí•´",
            4: "ë„ˆëŠ” íŠ¹ë³„í•œ ì‚¬ëŒì´ì•¼",
            5: "ğŸ‰ ìµœì¢… ìŠ¹ë¦¬! ì‚¬ë‘í•´, ì˜ì›íˆ í•¨ê»˜í•˜ì! ğŸ‰"
        };

        function selectMode(mode) {
            // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            
            // ì„ íƒëœ ë²„íŠ¼ í™œì„±í™”
            event.target.classList.add('active');
            
            // ëª¨ë“  ê²Œì„ ì˜ì—­ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.game-area').forEach(area => area.classList.remove('active'));
            
            if (mode === 'level1') {
                document.getElementById('level1-game').classList.add('active');
            } else if (mode === 'level4') {
                document.getElementById('fate-game').classList.add('active');
                startFateGame();
            }
        }

        // 1ë‹¨ê³„ ê²Œì„
        function playRPS(playerChoice) {
            const choices = ['rock', 'paper', 'scissors'];
            const choiceEmojis = { rock: 'âœŠ', paper: 'âœ‹', scissors: 'âœŒï¸' };
            const choiceNames = { rock: 'ë°”ìœ„', paper: 'ë³´', scissors: 'ê°€ìœ„' };
            
            const computerChoice = choices[Math.floor(Math.random() * 3)];
            
            let result = '';
            if (playerChoice === computerChoice) {
                result = 'ë¬´ìŠ¹ë¶€!';
            } else if (
                (playerChoice === 'rock' && computerChoice === 'scissors') ||
                (playerChoice === 'paper' && computerChoice === 'rock') ||
                (playerChoice === 'scissors' && computerChoice === 'paper')
            ) {
                result = 'ë‹¹ì‹ ì´ ì´ê²¼ì–´ìš”!';
            } else {
                result = 'ì»´í“¨í„°ê°€ ì´ê²¼ì–´ìš”!';
            }
            
            document.getElementById('level1-result').innerHTML = `
                <div>ë‹¹ì‹ : ${choiceEmojis[playerChoice]} vs ì»´í“¨í„°: ${choiceEmojis[computerChoice]}</div>
                <div style="margin: 10px 0; font-weight: bold;">${result}</div>
                ${result.includes('ë‹¹ì‹ ì´ ì´ê²¼ì–´ìš”') ? '<div class="love-message">ğŸ‰ ìƒëŒ€ë°©ì´ "ì¢‹ì•„í•´"ë¼ê³  ë§í•´ì•¼ í•´ìš”! ğŸ’•</div>' : ''}
                ${result.includes('ì»´í“¨í„°ê°€ ì´ê²¼ì–´ìš”') ? '<div class="love-message">ğŸ˜… ë‹¹ì‹ ì´ "ì¢‹ì•„í•´"ë¼ê³  ë§í•´ì•¼ í•´ìš”! ğŸ’•</div>' : ''}
            `;
        }

        function resetLevel1() {
            document.getElementById('level1-result').innerHTML = '';
        }

        // 4ë‹¨ê³„ ìš´ëª…ì˜ ì¹´ë“œ ê²Œì„ í•¨ìˆ˜ë“¤
        function startFateGame() {
            // ê²Œì„ ì´ˆê¸°í™”
            fatePlayer1Wins = 0;
            fatePlayer2Wins = 0;
            fateCurrentRound = 1;
            
            updateFateDisplay();
            startNewFateRound();
        }

        function startNewFateRound() {
            // ìˆœìˆ˜ ê°€ìœ„ë°”ìœ„ë³´ë§Œ ì‚¬ìš©
            const rpsOptions = [
                { emoji: 'âœŠ', name: 'ë°”ìœ„', type: 'rps' },
                { emoji: 'âœ‹', name: 'ë³´', type: 'rps' },
                { emoji: 'âœŒï¸', name: 'ê°€ìœ„', type: 'rps' }
            ];
            
            // 6ì¥ì˜ ì¹´ë“œë¥¼ ëœë¤í•˜ê²Œ ë°°ì¹˜ (ê°€ìœ„ë°”ìœ„ë³´ë§Œ)
            fateCards = [];
            for (let i = 0; i < 6; i++) {
                const randomCard = rpsOptions[Math.floor(Math.random() * rpsOptions.length)];
                fateCards.push(randomCard);
            }
            
            // ì¹´ë“œì— ë‚´ìš© ì„¤ì • (ë³´ì´ì§€ ì•Šê²Œ)
            for (let i = 0; i < 6; i++) {
                document.getElementById(`fate-card-${i}`).textContent = fateCards[i].emoji;
            }
            
            resetFateSelection();
            document.getElementById('fate-result').innerHTML = '';
        }

        function updateFateDisplay() {
            document.getElementById('fate-player1-wins').textContent = fatePlayer1Wins;
            document.getElementById('fate-player2-wins').textContent = fatePlayer2Wins;
            document.getElementById('current-round').textContent = fateCurrentRound;
            
            // ì§„í–‰ ìƒí™© ì‹œê°ì  í‘œì‹œ
            updateProgressBar('fate-player1-progress', fatePlayer1Wins);
            updateProgressBar('fate-player2-progress', fatePlayer2Wins);
            
            // ë¼ìš´ë“œ ì •ë³´ ì—…ë°ì´íŠ¸
            let roundInfo = '';
            if (fatePlayer1Wins === 0 && fatePlayer2Wins === 0) {
                roundInfo = 'ğŸ¯ ì²« ë²ˆì§¸ ëŒ€ê²°! ì—°ì†ìŠ¹ì„ ì‹œì‘í•˜ì„¸ìš”!';
            } else {
                const maxWins = Math.max(fatePlayer1Wins, fatePlayer2Wins);
                if (maxWins === 1) {
                    roundInfo = 'ğŸ”¥ 1ìŠ¹! ì—°ì†ìŠ¹ì´ ì‹œì‘ë˜ì—ˆì–´ìš”! ê³„ì† ì´ê¸°ë©´ ë” í° ë³´ìƒì´!';
                } else if (maxWins === 2) {
                    roundInfo = 'âš¡ 2ìŠ¹! í•œ ë²ˆë§Œ ë” ì´ê¸°ë©´ ìµœì¢… ìŠ¹ë¦¬! ê¸´ì¥í•˜ì„¸ìš”!';
                } else {
                    roundInfo = 'ğŸ† ëˆ„êµ°ê°€ 3ìŠ¹ì— ê°€ê¹Œì›Œì§€ê³  ìˆì–´ìš”!';
                }
            }
            document.getElementById('round-info').innerHTML = roundInfo;
        }

        function updateProgressBar(elementId, wins) {
            const progressElement = document.getElementById(elementId);
            let progress = '';
            for (let i = 0; i < 5; i++) {
                if (i < wins) {
                    progress += 'ğŸ”¥'; // ë‹¬ì„±í•œ ë‹¨ê³„
                } else {
                    progress += 'ğŸ”¹'; // ë¯¸ë‹¬ì„± ë‹¨ê³„
                }
            }
            progressElement.textContent = progress;
        }

        // ìŒì„± í•©ì„±ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¥¼ ì†Œë¦¬ë‚´ì–´ ì½ê¸°
        function speakText(text) {
            if (soundEnabled && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ko-KR'; // í•œêµ­ì–´ ì„¤ì •
                utterance.rate = speechRate; // ì†ë„ ì¡°ì ˆ
                utterance.pitch = speechPitch; // ìŒë†’ì´ ì¡°ì ˆ
                speechSynthesis.speak(utterance);
            }
        }
        
        // ìŒì„± ì„¤ì • í•¨ìˆ˜ë“¤
        function toggleSound() {
            soundEnabled = document.getElementById('soundToggle').checked;
            if (!soundEnabled) {
                // í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ìŒì„± ì¤‘ì§€
                speechSynthesis.cancel();
            }
        }
        
        function updateSpeechSettings() {
            speechRate = parseFloat(document.getElementById('speedSlider').value);
            speechPitch = parseFloat(document.getElementById('pitchSlider').value);
            
            // ìŠ¬ë¼ì´ë” ê°’ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('speedValue').textContent = speechRate;
            document.getElementById('pitchValue').textContent = speechPitch;
        }

        function selectFateCard(player, cardIndex) {
            if (fateRevealed) return;
            
            // ì´ë¯¸ ì„ íƒëœ ì¹´ë“œì¸ì§€ í™•ì¸
            if (fatePlayer1Selected === cardIndex || fatePlayer2Selected === cardIndex) {
                return; // ì´ë¯¸ ì„ íƒëœ ì¹´ë“œëŠ” ì„ íƒí•  ìˆ˜ ì—†ìŒ
            }
            
            // ì°¨ë¡€ í™•ì¸ (ì²« ë¼ìš´ë“œëŠ” í”Œë ˆì´ì–´1, ì´í›„ëŠ” ì§„ ì‚¬ëŒì´ ë¨¼ì €)
            let firstPlayer = getFirstPlayer();
            
            if (fatePlayer1Selected === null && fatePlayer2Selected === null) {
                // ì²« ë²ˆì§¸ ì„ íƒì
                if (firstPlayer === 'player1') {
                    fatePlayer1Selected = cardIndex;
                    document.querySelector(`#fate-card-${cardIndex}`).parentElement.classList.add('selected');
                    document.querySelector(`#fate-card-${cardIndex}`).parentElement.style.border = '3px solid #667eea';
                    document.getElementById('fate-player1-status').textContent = 'í”Œë ˆì´ì–´ 1: ì„ íƒ ì™„ë£Œ!';
                    document.getElementById('fate-player2-status').textContent = 'í”Œë ˆì´ì–´ 2: ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”';
                    document.getElementById('turn-indicator').textContent = 'í”Œë ˆì´ì–´ 2ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤!';
                } else {
                    fatePlayer2Selected = cardIndex;
                    document.querySelector(`#fate-card-${cardIndex}`).parentElement.classList.add('selected');
                    document.querySelector(`#fate-card-${cardIndex}`).parentElement.style.border = '3px solid #e91e63';
                    document.getElementById('fate-player2-status').textContent = 'í”Œë ˆì´ì–´ 2: ì„ íƒ ì™„ë£Œ!';
                    document.getElementById('fate-player1-status').textContent = 'í”Œë ˆì´ì–´ 1: ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”';
                    document.getElementById('turn-indicator').textContent = 'í”Œë ˆì´ì–´ 1ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤!';
                }
            } else {
                // ë‘ ë²ˆì§¸ ì„ íƒì
                if (fatePlayer1Selected === null) {
                    fatePlayer1Selected = cardIndex;
                    document.querySelector(`#fate-card-${cardIndex}`).parentElement.classList.add('selected');
                    document.querySelector(`#fate-card-${cardIndex}`).parentElement.style.border = '3px solid #667eea';
                    document.getElementById('fate-player1-status').textContent = 'í”Œë ˆì´ì–´ 1: ì„ íƒ ì™„ë£Œ!';
                } else {
                    fatePlayer2Selected = cardIndex;
                    document.querySelector(`#fate-card-${cardIndex}`).parentElement.classList.add('selected');
                    document.querySelector(`#fate-card-${cardIndex}`).parentElement.style.border = '3px solid #e91e63';
                    document.getElementById('fate-player2-status').textContent = 'í”Œë ˆì´ì–´ 2: ì„ íƒ ì™„ë£Œ!';
                }
                
                // ë‘˜ ë‹¤ ì„ íƒí–ˆìœ¼ë©´ ë’¤ì§‘ê¸° ë²„íŠ¼ í™œì„±í™”
                document.getElementById('fate-reveal-btn').disabled = false;
                document.getElementById('fate-reveal-btn').style.opacity = '1';
                document.getElementById('fate-reveal-btn').style.cursor = 'pointer';
                document.getElementById('turn-indicator').textContent = 'ëª¨ë“  ì„ íƒ ì™„ë£Œ! ìš´ëª…ì„ í™•ì¸í•˜ì„¸ìš”!';
            }
        }

        function getFirstPlayer() {
            // ì²« ë¼ìš´ë“œëŠ” í”Œë ˆì´ì–´ 1ì´ ë¨¼ì €, ì´í›„ëŠ” ì§„ ì‚¬ëŒì´ ë¨¼ì €
            if (fateCurrentRound === 1) {
                return 'player1';
            } else {
                // ë§ˆì§€ë§‰ì— ì§„ ì‚¬ëŒì´ ë¨¼ì € (lastWinnerì˜ ë°˜ëŒ€)
                return lastWinner === 'player1' ? 'player2' : 'player1';
            }
        }

        function revealFateCards() {
            if (fatePlayer1Selected === null || fatePlayer2Selected === null) return;
            
            fateRevealed = true;
            
            // ì„ íƒëœ ì¹´ë“œë“¤ë§Œ ë’¤ì§‘ê¸°
            document.querySelector(`#fate-card-${fatePlayer1Selected}`).parentElement.classList.add('flipped');
            document.querySelector(`#fate-card-${fatePlayer2Selected}`).parentElement.classList.add('flipped');
            
            // ê²°ê³¼ ê³„ì‚°
            setTimeout(() => {
                calculateFateResult();
            }, 600);
        }

        function calculateFateResult() {
            const player1Card = fateCards[fatePlayer1Selected];
            const player2Card = fateCards[fatePlayer2Selected];
            
            let result = '';
            let winner = '';
            
            // ìˆœìˆ˜ ê°€ìœ„ë°”ìœ„ë³´ ì²˜ë¦¬
            if (player1Card.name === player2Card.name) {
                result = 'ë¬´ìŠ¹ë¶€! ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”!';
                winner = 'draw';
            } else if (
                (player1Card.name === 'ë°”ìœ„' && player2Card.name === 'ê°€ìœ„') ||
                (player1Card.name === 'ë³´' && player2Card.name === 'ë°”ìœ„') ||
                (player1Card.name === 'ê°€ìœ„' && player2Card.name === 'ë³´')
            ) {
                result = 'í”Œë ˆì´ì–´ 1 ìŠ¹ë¦¬!';
                winner = 'player1';
            } else {
                result = 'í”Œë ˆì´ì–´ 2 ìŠ¹ë¦¬!';
                winner = 'player2';
            }
            
            // ì ìˆ˜ ì—…ë°ì´íŠ¸ (ìŠ¹ë¦¬ +1, íŒ¨ë°° -1, ë¬´ìŠ¹ë¶€ëŠ” ë³€í™” ì—†ìŒ)
            let rewardMessage = '';
            let scoreChangeMessage = '';
            
            if (winner === 'player1') {
                fatePlayer1Wins = Math.min(5, fatePlayer1Wins + 1); // ìµœëŒ€ 5ì 
                fatePlayer2Wins = Math.max(0, fatePlayer2Wins - 1); // ìµœì†Œ 0ì 
                lastWinner = 'player1';
                scoreChangeMessage = 'ğŸ“ˆ í”Œë ˆì´ì–´ 1: +1ì , í”Œë ˆì´ì–´ 2: -1ì ';
                
                // ë³´ìƒ ë©”ì‹œì§€ì™€ ìŒì„±
                if (fateRewards[fatePlayer1Wins]) {
                    rewardMessage = `<div style="margin-top: 15px; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px; font-size: 1.2rem;">
                        ğŸ‰ ${fatePlayer1Wins}ì  ë‹¬ì„±! í”Œë ˆì´ì–´ 2ê°€ ë§í•˜ì„¸ìš”: "<strong>${fateRewards[fatePlayer1Wins]}</strong>"
                    </div>`;
                    
                    // ìŒì„±ìœ¼ë¡œ ë§í•˜ê¸°
                    setTimeout(() => {
                        speakText(`${fatePlayer1Wins}ì  ë‹¬ì„±! í”Œë ˆì´ì–´ 2ê°€ ${fateRewards[fatePlayer1Wins]}ë¼ê³  ë§í•˜ì„¸ìš”`);
                    }, 1000);
                }
            } else if (winner === 'player2') {
                fatePlayer2Wins = Math.min(5, fatePlayer2Wins + 1); // ìµœëŒ€ 5ì 
                fatePlayer1Wins = Math.max(0, fatePlayer1Wins - 1); // ìµœì†Œ 0ì 
                lastWinner = 'player2';
                scoreChangeMessage = 'ğŸ“ˆ í”Œë ˆì´ì–´ 2: +1ì , í”Œë ˆì´ì–´ 1: -1ì ';
                
                // ë³´ìƒ ë©”ì‹œì§€ì™€ ìŒì„±
                if (fateRewards[fatePlayer2Wins]) {
                    rewardMessage = `<div style="margin-top: 15px; padding: 15px; background: linear-gradient(135deg, #e91e63 0%, #f06292 100%); color: white; border-radius: 10px; font-size: 1.2rem;">
                        ğŸ‰ ${fatePlayer2Wins}ì  ë‹¬ì„±! í”Œë ˆì´ì–´ 1ì´ ë§í•˜ì„¸ìš”: "<strong>${fateRewards[fatePlayer2Wins]}</strong>"
                    </div>`;
                    
                    // ìŒì„±ìœ¼ë¡œ ë§í•˜ê¸°
                    setTimeout(() => {
                        speakText(`${fatePlayer2Wins}ì  ë‹¬ì„±! í”Œë ˆì´ì–´ 1ì´ ${fateRewards[fatePlayer2Wins]}ë¼ê³  ë§í•˜ì„¸ìš”`);
                    }, 1000);
                }
            } else {
                scoreChangeMessage = 'ğŸ¤ ë¬´ìŠ¹ë¶€: ì ìˆ˜ ë³€í™” ì—†ìŒ';
            }
            
            document.getElementById('fate-result').innerHTML = `
                <div style="margin: 20px 0; text-align: center;">
                    <div style="font-size: 1.2rem; margin-bottom: 15px;">
                        í”Œë ˆì´ì–´ 1: ${player1Card.emoji} ${player1Card.name} vs í”Œë ˆì´ì–´ 2: ${player2Card.emoji} ${player2Card.name}
                    </div>
                    <div style="font-weight: bold; font-size: 1.3rem; margin-bottom: 10px;">
                        ${result}
                    </div>
                    <div style="font-size: 1.1rem; color: #666; margin: 10px 0;">
                        ${scoreChangeMessage}
                    </div>
                    ${rewardMessage}
                </div>
            `;
            
            fateCurrentRound++;
            updateFateDisplay();
            
            // ìµœì¢… ìŠ¹ë¦¬ í™•ì¸
            if (fatePlayer1Wins >= fateTargetWins || fatePlayer2Wins >= fateTargetWins) {
                const finalWinner = fatePlayer1Wins >= fateTargetWins ? 'í”Œë ˆì´ì–´ 1' : 'í”Œë ˆì´ì–´ 2';
                const loser = finalWinner === 'í”Œë ˆì´ì–´ 1' ? 'í”Œë ˆì´ì–´ 2' : 'í”Œë ˆì´ì–´ 1';
                document.getElementById('fate-result').innerHTML += `
                    <div class="love-message" style="font-size: 1.5rem; margin-top: 20px; animation: pulse 2s infinite;">
                        ğŸ† ${finalWinner} ìµœì¢… ìŠ¹ë¦¬! ğŸ†<br>
                        ${loser}ê°€ "${fateRewards[5]}"ë¼ê³  ë§í•˜ì„¸ìš”!
                    </div>
                `;
                
                // ìµœì¢… ìŠ¹ë¦¬ ìŒì„±
                setTimeout(() => {
                    speakText(`${finalWinner} ìµœì¢… ìŠ¹ë¦¬! ${loser}ê°€ ${fateRewards[5]}ë¼ê³  ë§í•˜ì„¸ìš”!`);
                }, 1500);
                return;
            }
            
            // ë‹¤ìŒ ë¼ìš´ë“œ ì¤€ë¹„
            setTimeout(() => {
                startNewFateRound();
            }, 3000);
        }

        function resetFateSelection() {
            fatePlayer1Selected = null;
            fatePlayer2Selected = null;
            fateRevealed = false;
            
            // ëª¨ë“  ì¹´ë“œ ì´ˆê¸°í™”
            document.querySelectorAll('.fate-card').forEach(card => {
                card.classList.remove('flipped', 'selected');
                card.style.border = '';
            });
            
            // ì°¨ë¡€ì— ë”°ë¥¸ ìƒíƒœ ë©”ì‹œì§€ ì„¤ì •
            let firstPlayer = getFirstPlayer();
            if (firstPlayer === 'player1') {
                document.getElementById('fate-player1-status').textContent = 'í”Œë ˆì´ì–´ 1: ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”';
                document.getElementById('fate-player2-status').textContent = 'í”Œë ˆì´ì–´ 2: ì°¨ë¡€ë¥¼ ê¸°ë‹¤ë¦¬ì„¸ìš”';
                document.getElementById('turn-indicator').textContent = 'í”Œë ˆì´ì–´ 1ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤!';
            } else {
                document.getElementById('fate-player1-status').textContent = 'í”Œë ˆì´ì–´ 1: ì°¨ë¡€ë¥¼ ê¸°ë‹¤ë¦¬ì„¸ìš”';
                document.getElementById('fate-player2-status').textContent = 'í”Œë ˆì´ì–´ 2: ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”';
                document.getElementById('turn-indicator').textContent = 'í”Œë ˆì´ì–´ 2ì˜ ì°¨ë¡€ì…ë‹ˆë‹¤! (ì´ì „ ë¼ìš´ë“œ íŒ¨ë°°ìê°€ ë¨¼ì €)';
            }
            
            document.getElementById('fate-player1-status').style.color = '#667eea';
            document.getElementById('fate-player2-status').style.color = '#e91e63';
            
            // ë’¤ì§‘ê¸° ë²„íŠ¼ ë¹„í™œì„±í™”
            document.getElementById('fate-reveal-btn').disabled = true;
            document.getElementById('fate-reveal-btn').style.opacity = '0.5';
            document.getElementById('fate-reveal-btn').style.cursor = 'not-allowed';
        }

        function resetFateGame() {
            startFateGame();
        }
    </script>
</body>
</html>
